#include <glib.h>
#include <string.h>
#include <libotr4/constants.h>
#include "../otr_parse.c"

void
otrv4_toolkit_test_parse_data_message()
{
        const char *msg = "?OTR:AAQDAAAAAAAAAAAAAAAAAAAAAAHyCwN0UvdtAN1sj2u7eZRt0bJz4OcsY8oWVNUhdjjKJt4vG3R7X9thzjq2ekbCl7N96H7zwpQ6aAAAAAGAcYUv8x0Gi9Jq2XVfDc0opoRHMVk618tPANF7c3xTqjVgpvTC8vMtOP9+m8YnaauZWkStx252if+DKIH2rrAwzokYUtoG+whQ7e/d4TD0F8Reiz7U/iZwvbY25ki5MGi+3oi2PnUZRtR2I5w7ZslCFLq/Fx++yU7IIKsb7FgMTG53OsuTr6kRDgzuJQnzNkFcHpZKMcugi8IU8nDnI3+gnLOmoNe2OcpuuutM+K4OLme2s6yk8D6YZFGAJCqE4tqVEPLoT3aZSDcwrsJZzRrcSlpqiULk9B/uF5zg1Gs7fsZiBE63tzI53Et79PDRkVWyQTzIpIpf883tzVuJam3yr7TgFFUvuoEhn6hQLb903fyV2yaZw1wFhqGztL1WtAi//L282RW/6CPQt4dpctgU8HGWrzo4cNWjTXH/zZ0H2Ys5KLWvcIyTRPKG9Nh/jl3nXwPhnY2oY3vSZRB3b80D8t5VkYNFvZmUGnbGsBzT0pUYUa96DiAX3Yt6cf197aN8uNXPEVh9XtFdHOO7ozYgOOPAAJMLNstBAAAAA54uWlLmsh23Qru0vjwfcfVDL0AJdXyd0GtUQPgT8gCxA5S7t/CqnJ0ajpmLh0W7s0sxoN2ZwVXBwXrF0a9N0biwLFc=., ?OTR:AAQDAAAAAAAAAAAAAAAAAAAAAALyCwN0UvdtAN1sj2u7eZRt0bJz4OcsY8oWVNUhdjjKJt4vG3R7X9thzjq2ekbCl7N96H7zwpQ6aAAAAAGAcYUv8x0Gi9Jq2XVfDc0opoRHMVk618tPANF7c3xTqjVgpvTC8vMtOP9+m8YnaauZWkStx252if+DKIH2rrAwzokYUtoG+whQ7e/d4TD0F8Reiz7U/iZwvbY25ki5MGi+3oi2PnUZRtR2I5w7ZslCFLq/Fx++yU7IIKsb7FgMTG53OsuTr6kRDgzuJQnzNkFcHpZKMcugi8IU8nDnI3+gnLOmoNe2OcpuuutM+K4OLme2s6yk8D6YZFGAJCqE4tqVEPLoT3aZSDcwrsJZzRrcSlpqiULk9B/uF5zg1Gs7fsZiBE63tzI53Et79PDRkVWyQTzIpIpf883tzVuJam3yr7TgFFUvuoEhn6hQLb903fyV2yaZw1wFhqGztL1WtAi//L282RW/6CPQt4dpctgU8HGWrzo4cNWjTXH/zZ0H2Ys5KLWvcIyTRPKG9Nh/jl3nXwPhnY2oY3vSZRB3b80D8t5VkYNFvZmUGnbGsBzT0pUYUa96DiAX3Yt6cf197aN8EbwUUl1KhASvXgv7GMu7BgYonfDzV5YsAAAAA2okFbNzvcFzybm8QoclOiFxqtHc1iJNt/Iwy+46BYKy6bjAiynGq8qIkTyM+cimZgwkK0Elq0meZ4Y7nsKCHc7ONz4=., ?OTR:AAQDAAAAAAAAAAAAAAAAAAAAAAPyCwN0UvdtAN1sj2u7eZRt0bJz4OcsY8oWVNUhdjjKJt4vG3R7X9thzjq2ekbCl7N96H7zwpQ6aAAAAAGAcYUv8x0Gi9Jq2XVfDc0opoRHMVk618tPANF7c3xTqjVgpvTC8vMtOP9+m8YnaauZWkStx252if+DKIH2rrAwzokYUtoG+whQ7e/d4TD0F8Reiz7U/iZwvbY25ki5MGi+3oi2PnUZRtR2I5w7ZslCFLq/Fx++yU7IIKsb7FgMTG53OsuTr6kRDgzuJQnzNkFcHpZKMcugi8IU8nDnI3+gnLOmoNe2OcpuuutM+K4OLme2s6yk8D6YZFGAJCqE4tqVEPLoT3aZSDcwrsJZzRrcSlpqiULk9B/uF5zg1Gs7fsZiBE63tzI53Et79PDRkVWyQTzIpIpf883tzVuJam3yr7TgFFUvuoEhn6hQLb903fyV2yaZw1wFhqGztL1WtAi//L282RW/6CPQt4dpctgU8HGWrzo4cNWjTXH/zZ0H2Ys5KLWvcIyTRPKG9Nh/jl3nXwPhnY2oY3vSZRB3b80D8t5VkYNFvZmUGnbGsBzT0pUYUa96DiAX3Yt6cf197aN8sxWPA8Jaq5EidFvH2BIFVXhjGPT+SiNiAAAAA+hsCKr3W38UedHWnKbFKSvNquOCUg+BMd9f4UdeMOlNWM5PuAm2O89ELFcHehnCJ/GwO+yjVQfhu1chbRxqbvroS6Q=.";


	encoded_msg_t *data_msg = NULL;
        data_msg = malloc(sizeof(encoded_msg_t));

	g_assert_cmpint(parse(data_msg, msg, strlen(msg)), ==, 0);
	g_assert_cmpint(data_msg->type, ==, OTR_DATA_MSG_TYPE);

	free(data_msg);
}

